<?xml version="1.0" encoding="UTF-8"?>

<project name="Arbitrary file cleaning" default="clean.clean">

  <!--
      Given the following properties:

      clean.files: Set of files to delete (File name and path. No wildcards)

      Delete the given files from the directory.
  -->

  <import file="InitialCheck.xml"/>

  <property name="clean.files"   value=""/>
  
  <!-- Private properties -->
  <property name="clean.debug.level"    value="${ada.debug.level}"/>

  <!-- Set of files to delete -->
  <filelist id="clean.filelist" dir="${basedir}" files="${clean.files}"/>

  <!-- Preliminary target to verify that certain minimum conditions hold before
  executing the regular targets. -->
  <target name="clean.check.values" 
	  depends="initial.check, clean.dump.properties"> 

    <!-- Condition to enable/disable the rest of the execution -->
    <condition property="clean.check">
      <not><equals arg1="${clean.files}" arg2=""/></not>
    </condition>

    <!-- Dump the value of the properties just computed. -->
    <echo level="${clean.debug.level}">    clean.check          = "${clean.check}"</echo>

    <delete>
      <fileset followsymlinks="false" dir="${basedir}" includes="*~"
	       defaultexcludes="no"/>
    </delete>
  </target>

  <!-- Target to notify that the regular target has not been executed. This is
  to notify the user -->
  <target name="clean.clean.NOT" unless="clean.check">
    <echo>clean.clean                 ---</echo>
    <echo level="${clean.debug.level}">${basedir}</echo>
  </target>

  <target name="clean.clean" depends="clean.check.values, clean.clean.NOT"
	  if="clean.check"
	  description="Cleans local and recursive dirs">
    
    <echo>clean.clean                 RUN</echo>
    <echo level="${clean.debug.level}">${basedir}</echo>

    <!-- Dump explicitly the files to be deleted -->
    <echo> deleted = ${clean.files}</echo>

    <delete includeemptydirs="true">
      <fileset dir=".">
        <include name="build.out"/>
      </fileset>
      <filelist refid="clean.filelist"/>
    </delete>
  </target>

  <target name="clean.dump.properties" depends="initial.check">
    <echo level="${clean.debug.level}"> ------ Clean properties ----
    clean.files        = "${clean.files}"</echo>
  </target>
</project>
