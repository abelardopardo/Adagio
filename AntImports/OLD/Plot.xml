<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id: Plot.xml,v 1.2 2005/09/06 12:37:48 abel Exp $ -->

<project name="GNU Plot Processing" default="local.build" basedir=".">
  <!-- ================================================================ -->
  <!--                         PLOT PROCESSING                          -->
  <!-- ================================================================ -->
  <target name="plot.processing" depends="initial.check"
    if="plot.ready"
      description="Creates plots to be included in latex documents">
    <echo>plot.processing: ${basedir}</echo>

    <dependset>
      <srcfileset dir="${plot.dir}">
        <include name="*.plot"/>
      </srcfileset>
      <targetfileset dir="${plot.dir}">
        <include name="*.fig"/>
      </targetfileset>
    </dependset>

    <apply dir="${plot.dir}" parallel="false" dest="${plot.dir}" append="yes"
      failonerror="true" executable="gnuplot" os="Linux" output="${plot.dir}/build.out">
      <srcfile/>
      <fileset refid="plot.files"/>
      <mapper type="glob" from="*.plot" to="*.fig"/>
    </apply>    

    <apply dir="${plot.dir}" parallel="false" dest="${plot.dir}" append="yes"
      failonerror="true" executable="fig2dev" os="Linux" output="${plot.dir}/build.out">
      <arg value="-L"/>
      <arg value="${figure.mode}"/>
      <srcfile/>
      <targetfile/>
      <fileset dir="${plot.dir}">
        <include name="*.fig"/>
      </fileset>
      <mapper type="glob" from="*.fig" to="*.${figure.mode}"/>
    </apply>    

  </target>
  
  <target name="plot.clean" depends="initial.check" if="plot.ready"
    description="Clean temporary file derived from plots">
    
    <echo>plot.clean: ${basedir}</echo>

    <delete>
      <fileset dir="${plot.dir}">
        <include name="plot.out"/>
      </fileset>
      <fileset dir="${plot.dir}">
	<present targetdir="${plot.dir}">
	  <mapper type="glob" from="*.${figure.mode}" to="*.fig"/>
	</present>
      </fileset>
      <fileset dir="${plot.dir}">
	<present targetdir="${plot.dir}">
	  <mapper type="glob" from="*.fig" to="*.plot"/>
	</present>
      </fileset>
    </delete>

  </target>

</project>  
